<!DOCTYPE html>
<html>
<head>
        <link rel="stylesheet" href="main.css">
    <script>
        function inputDesserts() {
            for (var i = 5; i< 10; i++){
                addDessert(i);
            }
            for (var i = 5; i< 10; i++){
                getComments(i);
            }
        }

        function addDessert(id) {
            var httpRequest = new XMLHttpRequest();
            httpRequest.onreadystatechange = function() {
                if(this.readyState === 4 && this.status === 200) {
                    var newObj = JSON.parse(httpRequest.responseText);
                    addResults(newObj, id);

                }
            };
            httpRequest.open("GET", '/getDessert?id='+ id, true);
            httpRequest.send();
            console.log("Getting id:" + id);
        }
        function addResults(json, id) {
            console.log(json);

            var result = document.getElementById('results');
            var newItem = document.createElement('p');
            var text = document.createTextNode('');
            
            newItem.appendChild(text);
    
            newItem.innerHTML = "<div class='container'> <div class='box'><h2>" + json.name + "</h2><div class='displayRight'><img src='" + json.picture + "'><p class='desc'>" 
                  + json.description + "</p><br><br></div><h2>Comments</h2><div class='box' id='comments" + id + "'></div>"
                  +  "<form method='POST' action='/addComment'><h2> Add Comment  </h2>" 
                  +  "<label> Title: </label><input type='text' name='name'></input><br />"
                  +  "<label> Rating: </label><select name='rating'><option value='1'>1 Star</option><option value='2'>2 Star</option>"
                  +  "<option value='3'>3 Star</option><option value='4'>4 Star</option><option value='5'>5 Star</option></select><br />"
                  +  "<label> Comment: </label><input type='text' name='comment'></input><br />"
                  +  "<input type='hidden' name='dessertId' value='" + id + "'></input><br /><input class='submit' type='submit' value='Add comment'></form>"; 
             result.appendChild(newItem);
        }

        function getComments(id){
            var httpRequest = new XMLHttpRequest();
        
            httpRequest.onreadystatechange = function() {
                if(this.readyState === 4 && this.status === 200) {
                    var newObj = JSON.parse(httpRequest.responseText);
                    displayComments(newObj, id);

                }
            };
            httpRequest.open("GET", '/getComment?id='+ id  , true);
            httpRequest.send();
            console.log("Comment for:" + id);
        }

        function displayComments(json, id){
            console.log(json);
            var details = document.getElementById("comments" + id);

            for(var i= 0; i < json.length; i++)
            {
                details.innerHTML +=  "<h3>" + json[i].name + "</h3>" 
                 + "<p>User: " + json[i].username + "</p>"
                 + "<p>" + json[i].rating + " stars <br>" 
                 + "<br>" + json[i].comment + "</p><br>";
            }
          

        }



    </script>
</head>
<body onload="inputDesserts()">
    <h1>Desserts</h1>
    <p id="results"></p>
    <p id="details"></p>
    


</body>
</html>
