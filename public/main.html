<!DOCTYPE html>
<html>
<head>
    <script>
        function inputDesserts() {
            for (var i = 1; i< 5; i++){
                addDessert(i);
            }
        }

        function addDessert(id) {
            var httpRequest = new XMLHttpRequest();
            httpRequest.onreadystatechange = function() {
                if(this.readyState === 4 && this.status === 200) {
                    var newObj = JSON.parse(httpRequest.responseText);
                    addResults(newObj);

                }
            };
            httpRequest.open("GET", '/getDessert?id='+ id, true);
            httpRequest.send();
            console.log("Getting id:" + id);
        }
        function addResults(json) {
            console.log(json);

            var result = document.getElementById('results');
            var newItem = document.createElement('p');
            var text = document.createTextNode('');
            
            newItem.appendChild(text);
    
            newItem.innerHTML = json.name + "<br>" 
                  + "Description: " + json.description + "<br>"
                  + "<button onclick='getDetails'>Add Comment</button> "; 
                  //+ "Poster: <img src='" + json.Poster + "' ><br>"; 
             result.appendChild(newItem);
        }

        function getDetails(id){
            var httpRequest = new XMLHttpRequest();
        
            httpRequest.onreadystatechange = function() {
                if(this.readyState === 4 && this.status === 200) {
                    var newObj = JSON.parse(httpRequest.responseText);
                    displayDetails(newObj);

                }
            };
            httpRequest.open("GET", 'http://www.omdbapi.com/?apikey=6456d685&i='+ id  , true);
            httpRequest.send();
            console.log("searching for:" + id);
        }

        function displayDetails(json){
            console.log(json);
            var details = document.getElementById("details");


            details.innerHTML = "Title: " + json.Title + "<br>" 
                              + "Genre: " + json.Genre + "<br>"
                              + "Released: " + json.Released + "<br>"
                              + "Rated: " + json.Rated + "<br>"
                              + "Poster: <img src='" + json.Poster + "' ><br>"; 

        }

    </script>
</head>
<body onload="inputDesserts()">
    <h1>Desserts</h1>
    <p id="results"></p>



</body>
</html>
